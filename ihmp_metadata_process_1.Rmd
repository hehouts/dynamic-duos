---
title: "iHMP_metadata_analysis_1"
output: html_document
---

### Setup

```{r setwd, include=FALSE}
#setwd("/Users/hehouts/Projects/2020-IBD-Virome")
```

```{r trunc-output, include=FALSE}
# save the built-in output hook
hook_output <- knitr::knit_hooks$get("output")

# set a new output hook to truncate text output
knitr::knit_hooks$set(output = function(x, options) {
  if (!is.null(n <- options$out.lines)) {
    x <- xfun::split_lines(x)
    if (length(x) > n) {
      # truncate the output
      x <- c(head(x, n), "....\n")
    }
    x <- paste(x, collapse = "\n")
  }
  hook_output(x, options)
})
```


Load libraries
```{r load-libs, message=FALSE, warning=FALSE}
library(readr)
library(dplyr)
library(stringr)
```

Load Data
```{r load-data, message=FALSE, warning=FALSE}
og_metadata <- readr::read_csv("ihmp_metadata.csv")
```

### Explore metadata
Examine data:
703 viromics samples
```{r exmn-data}
barplot(table(og_metadata$data_type))
table(og_metadata$data_type)
```

Examine colnames:
```{r exmn-data-dims, out.lines=8}
print(og_metadata)
```
```{r exmn-col-names, out.lines=25}
colnames(og_metadata)
```

### Isolating metadata of interest
The first goal will be to isolate only subject IDs with viral data

isolate viral data from IBD project

```{r exmn-virdata, out.lines=25}
vir_metadata <- og_metadata %>%
    filter(data_type=="viromics") %>%
    rename(research_project=`Research Project`) %>%
    rename(participant_id=`Participant ID`) %>%
    rename(external_id=`External ID`) %>%
    rename(age_at_diagnosis=`Age at diagnosis`) %>%
    filter(research_project=="ibdmdb")
print(vir_metadata)
```


```{r, include=FALSE, results=FALSE}
# String searches didnt help id specific antibiotic bc the phrase "antibiotic" is not present in the table, just the whole names of the antibiotic. but it did help id relevant columns

#str_detect(string = colnames(viral_metadata), pattern = "ntibiot")
colnames(vir_metadata)[str_detect(string = colnames(vir_metadata), pattern = "ntibiot")]

```

I want to look at columns "Antibiotics", "Has the subject used any antibiotics since the last visit?", "In the past 6 months, have you used antibiotics?", "Other Antibiotic:", and "Reason for stopping other antibiotic:"

first, some column renaming
```{r}
vir_metadata <- vir_metadata %>%
    rename(abx=`Antibiotics`) %>%
    rename(abx_since_last_visit=`Has the subject used any antibiotics since the last visit?`) %>%
    rename(abx_past_6_mo=`In the past 6 months, have you used antibiotics?`) %>%
    rename(abx_other=`Other Antibiotic:`) %>%
    rename(abx_other_reason_for_stopping=`Reason for stopping other antibiotic:`)

```

the Antibiotic columns (except abx) dont have data at all, likely stored under a different -omics line, so will find that later. 
```{r}
exp_metadata <- vir_metadata %>%
    filter(abx=="Yes") %>%
    select(abx, participant_id)
print (exp_metadata)

exp_metadata <- vir_metadata %>%
    filter(!is.na(abx_since_last_visit))
print (exp_metadata)

exp_metadata <- vir_metadata %>%
    filter(!is.na(abx_past_6_mo))
print (exp_metadata)

exp_metadata <- vir_metadata %>%
    filter(!is.na(abx_other))
print (exp_metadata)

exp_metadata <- vir_metadata %>%
    filter(!is.na(abx_other_reason_for_stopping))
print (exp_metadata)

```
This is the list of viromics samples relevant to the study
```{r}
viromics_samples_metadata <- vir_metadata %>%
    filter(abx=="Yes") %>%
    arrange(participant_id, week_num)

print(viromics_samples_metadata)
```

This is the list of participants relevant to the study, theres 34 lol
```{r}
participants <- vir_metadata%>%
    filter(abx=="Yes") %>%
    arrange(participant_id, week_num) %>%
    select(participant_id) %>%
    distinct(participant_id)
print(participants)
```


### So now lets get that sample numbers, in a list
```{}
C3002
C3003
C3008
C3010
C3016
C3017
C3027
C3031
C3034
C3037
E5009
H4006
H4013
H4015
H4016
H4017
H4018
H4024
H4030
H4035
H4038
H4039
M2025
M2028
M2064
M2068
M2069
M2077
P6010
P6016
P6018
P6024
P6028
P6037
```

